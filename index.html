<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #f8fafc;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
            --user-message-bg: #6366f1;
            --assistant-message-bg: #f1f5f9;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .app-header {
            background-color: white;
            border-bottom: 1px solid var(--border-color);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background-color: var(--primary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .app-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }
        
        .app-subtitle {
            font-size: 0.75rem;
            color: #64748b;
            margin: 0;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .status-badge {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-demo {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-connected {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .sidebar {
            width: 260px;
            background-color: white;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .new-chat-btn {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        
        .new-chat-btn:hover {
            background-color: #5558e3;
        }
        
        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .chat-history-item {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s;
        }
        
        .chat-history-item:hover {
            background-color: #f1f5f9;
        }
        
        .chat-history-item.active {
            background-color: #eef2ff;
            color: var(--primary-color);
        }
        
        .chat-history-icon {
            color: #94a3b8;
        }
        
        .chat-history-title {
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-header {
            padding: 15px 20px;
            background-color: white;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-title {
            font-weight: 500;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .model-selector {
            background-color: #f1f5f9;
            border-radius: 20px;
            padding: 4px 12px;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-color);
        }
        
        .chat-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .action-btn:hover {
            background-color: #f1f5f9;
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #fafbfc;
        }
        
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }
        
        .welcome-icon {
            width: 80px;
            height: 80px;
            background-color: #eef2ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 2rem;
        }
        
        .welcome-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .welcome-description {
            color: #64748b;
            max-width: 500px;
            margin-bottom: 30px;
        }
        
        .example-prompts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            max-width: 600px;
            width: 100%;
        }
        
        .example-prompt {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .example-prompt:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .example-prompt-title {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .example-prompt-text {
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .message {
            display: flex;
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            flex-shrink: 0;
            margin: 0 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .user .message-avatar {
            background-color: var(--user-message-bg);
            color: white;
        }
        
        .assistant .message-avatar {
            background-color: var(--assistant-message-bg);
            color: var(--text-color);
        }
        
        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
        }
        
        .user .message-content {
            background-color: var(--user-message-bg);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .assistant .message-content {
            background-color: white;
            color: var(--text-color);
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        .typing-indicator {
            display: none;
            padding: 15px;
        }
        
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #9ca3af;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
        
        .input-container {
            padding: 20px;
            background-color: white;
            border-top: 1px solid var(--border-color);
        }
        
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: flex-end;
            background-color: #f8fafc;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 12px;
            transition: border-color 0.2s;
        }
        
        .input-wrapper:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .chat-input {
            flex: 1;
            border: none;
            background: none;
            outline: none;
            resize: none;
            max-height: 200px;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .send-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.2s;
        }
        
        .send-button:hover {
            background-color: #5558e3;
        }
        
        .send-button:disabled {
            background-color: #c7d2fe;
            cursor: not-allowed;
        }
        
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .settings-content {
            background-color: white;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .settings-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }
        
        .settings-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #64748b;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .settings-close:hover {
            background-color: #f1f5f9;
        }
        
        .settings-body {
            padding: 20px;
        }
        
        .settings-section {
            margin-bottom: 25px;
        }
        
        .settings-section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .form-text {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 5px;
        }
        
        .settings-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .btn-secondary {
            background-color: #f1f5f9;
            color: var(--text-color);
        }
        
        .btn-secondary:hover {
            background-color: #e2e8f0;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #5558e3;
        }
        
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .api-status.demo {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .api-status.connected {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: currentColor;
        }
        
        .feature-card {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        
        .feature-title {
            font-weight: 500;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feature-description {
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification.success .notification-icon {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .notification.error .notification-icon {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        
        .notification.info .notification-icon {
            background-color: #dbeafe;
            color: #1d4ed8;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .notification-message {
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .notification-close:hover {
            background-color: #f1f5f9;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -260px;
                top: 0;
                bottom: 0;
                z-index: 100;
                transition: left 0.3s ease;
                box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .message-content {
                max-width: 85%;
            }
        }
        
        @media (min-width: 769px) {
            .menu-toggle {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="bi bi-cpu"></i>
                </div>
                <div>
                    <h1 class="app-title">AI Agent Tool</h1>
                    <p class="app-subtitle">Your intelligent assistant</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="status-badge status-demo" id="statusBadge">
                    <span class="status-dot"></span>
                    <span>Demo Mode</span>
                </div>
                <button class="btn btn-primary" id="apiSettingsBtn">
                    <i class="bi bi-key me-1"></i> API Settings
                </button>
            </div>
        </header>
        
        <div class="main-content">
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <button class="new-chat-btn" id="newChatBtn">
                        <i class="bi bi-plus-lg"></i>
                        <span>New Chat</span>
                    </button>
                </div>
                <div class="chat-history" id="chatHistory">
                    <!-- Chat history items will be added here dynamically -->
                </div>
            </aside>
            
            <main class="chat-container">
                <div class="chat-header">
                    <button class="action-btn menu-toggle" id="menuToggle">
                        <i class="bi bi-list"></i>
                    </button>
                    <h2 class="chat-title" id="chatTitle">New Conversation</h2>
                    <div class="chat-actions">
                        <button class="action-btn" id="clearChatBtn" title="Clear conversation">
                            <i class="bi bi-trash"></i>
                        </button>
                        <button class="action-btn" id="settingsBtn" title="Settings">
                            <i class="bi bi-gear"></i>
                        </button>
                    </div>
                </div>
                
                <div class="messages-container" id="messagesContainer">
                    <div class="welcome-screen" id="welcomeScreen">
                        <div class="welcome-icon">
                            <i class="bi bi-chat-dots"></i>
                        </div>
                        <h3 class="welcome-title">How can I help you today?</h3>
                        <p class="welcome-description">
                            I'm your AI assistant. I can help you with a variety of tasks, from answering questions to generating creative content.
                        </p>
                        <div class="example-prompts">
                            <div class="example-prompt" data-prompt="Explain quantum computing in simple terms">
                                <div class="example-prompt-title">Explain complex concepts</div>
                                <div class="example-prompt-text">Explain quantum computing in simple terms</div>
                            </div>
                            <div class="example-prompt" data-prompt="Write a poem about artificial intelligence">
                                <div class="example-prompt-title">Get creative</div>
                                <div class="example-prompt-text">Write a poem about artificial intelligence</div>
                            </div>
                            <div class="example-prompt" data-prompt="Help me plan a trip to Japan">
                                <div class="example-prompt-title">Plan something</div>
                                <div class="example-prompt-text">Help me plan a trip to Japan</div>
                            </div>
                            <div class="example-prompt" data-prompt="What are the latest developments in AI?">
                                <div class="example-prompt-title">Learn something new</div>
                                <div class="example-prompt-text">What are the latest developments in AI?</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="typing-indicator" id="typingIndicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
                
                <div class="input-container">
                    <div class="input-wrapper">
                        <textarea class="chat-input" id="chatInput" placeholder="Message AI Agent..." rows="1"></textarea>
                        <button class="send-button" id="sendButton">
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <div class="settings-modal" id="apiSettingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <h3 class="settings-title">API Settings</h3>
                <button class="settings-close" id="closeApiSettings">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="settings-body">
                <div class="api-status demo" id="apiStatus">
                    <span class="status-dot"></span>
                    <span>Currently running in demo mode with simulated responses</span>
                </div>
                
                <div class="settings-section">
                    <h4 class="settings-section-title">
                        <i class="bi bi-key"></i>
                        OpenAI API Key
                    </h4>
                    <div class="form-group">
                        <label class="form-label" for="apiKeyInput">API Key</label>
                        <input type="password" class="form-control" id="apiKeyInput" placeholder="sk-...">
                        <div class="form-text">Your API key is stored locally and never sent to any server except OpenAI.</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4 class="settings-section-title">
                        <i class="bi bi-cpu"></i>
                        Model Selection
                    </h4>
                    <div class="form-group">
                        <label class="form-label" for="modelSelect">AI Model</label>
                        <select class="form-control" id="modelSelect">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Recommended)</option>
                            <option value="gpt-4">GPT-4 (More capable)</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo (Latest)</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4 class="settings-section-title">
                        <i class="bi bi-person-gear"></i>
                        System Prompt
                    </h4>
                    <div class="form-group">
                        <label class="form-label" for="systemPrompt">Assistant Behavior</label>
                        <textarea class="form-control" id="systemPrompt" rows="3">You are a helpful assistant. Be concise and helpful in your responses.</textarea>
                        <div class="form-text">This defines how the AI assistant behaves.</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4 class="settings-section-title">
                        <i class="bi bi-info-circle"></i>
                        Demo vs. Full Mode
                    </h4>
                    <div class="feature-card">
                        <div class="feature-title">
                            <i class="bi bi-play-circle"></i>
                            Demo Mode
                        </div>
                        <div class="feature-description">
                            Use the tool without an API key. Responses are simulated and may not be as accurate or comprehensive.
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-title">
                            <i class="bi bi-star"></i>
                            Full Mode
                        </div>
                        <div class="feature-description">
                            Connect to OpenAI's API with your own key for more accurate, comprehensive, and up-to-date responses.
                        </div>
                    </div>
                </div>
            </div>
            <div class="settings-footer">
                <button class="btn btn-secondary" id="disconnectApiBtn" style="display: none;">Disconnect</button>
                <button class="btn btn-primary" id="saveApiSettingsBtn">Save Settings</button>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="bi bi-check"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">Success</div>
            <div class="notification-message">Settings saved successfully</div>
        </div>
        <button class="notification-close">
            <i class="bi bi-x"></i>
        </button>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const messagesContainer = document.getElementById('messagesContainer');
            const chatInput = document.getElementById('chatInput');
            const sendButton = document.getElementById('sendButton');
            const welcomeScreen = document.getElementById('welcomeScreen');
            const typingIndicator = document.getElementById('typingIndicator');
            const apiSettingsModal = document.getElementById('apiSettingsModal');
            const apiSettingsBtn = document.getElementById('apiSettingsBtn');
            const closeApiSettings = document.getElementById('closeApiSettings');
            const saveApiSettingsBtn = document.getElementById('saveApiSettingsBtn');
            const disconnectApiBtn = document.getElementById('disconnectApiBtn');
            const apiKeyInput = document.getElementById('apiKeyInput');
            const modelSelect = document.getElementById('modelSelect');
            const systemPrompt = document.getElementById('systemPrompt');
            const statusBadge = document.getElementById('statusBadge');
            const apiStatus = document.getElementById('apiStatus');
            const notification = document.getElementById('notification');
            const newChatBtn = document.getElementById('newChatBtn');
            const clearChatBtn = document.getElementById('clearChatBtn');
            const chatHistory = document.getElementById('chatHistory');
            const chatTitle = document.getElementById('chatTitle');
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const settingsBtn = document.getElementById('settingsBtn');
            
            // State
            let apiKey = localStorage.getItem('openai_api_key') || '';
            let model = localStorage.getItem('openai_model') || 'gpt-3.5-turbo';
            let systemPromptText = localStorage.getItem('system_prompt') || 'You are a helpful assistant. Be concise and helpful in your responses.';
            let conversationHistory = [];
            let chatSessions = JSON.parse(localStorage.getItem('chat_sessions')) || [];
            let currentSessionId = null;
            
            // Demo responses for when no API key is provided
            const demoResponses = [
                "I understand your question. In demo mode, I can provide basic responses, but they're not as comprehensive as when connected to the full AI model.",
                "That's an interesting point! While in demo mode, I'm limited in my responses. For more detailed and accurate answers, consider adding your OpenAI API key in the settings.",
                "I'd be happy to help with that! However, I'm currently running in demo mode with simulated responses. For the best experience, add your API key in the settings.",
                "Thanks for your message! In demo mode, I can provide general responses, but they may not be as accurate or detailed as when connected to the actual AI model.",
                "I appreciate your question! As a demo, I can give you a basic response. For more in-depth and accurate answers, you'll want to connect to the full AI model with your API key."
            ];
            
            // Initialize
            updateApiStatus();
            loadChatSessions();
            
            // Event Listeners
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keydown', handleKeyDown);
            apiSettingsBtn.addEventListener('click', openApiSettings);
            closeApiSettings.addEventListener('click', closeApiSettingsModal);
            saveApiSettingsBtn.addEventListener('click', saveApiSettings);
            disconnectApiBtn.addEventListener('click', disconnectApi);
            newChatBtn.addEventListener('click', startNewChat);
            clearChatBtn.addEventListener('click', clearCurrentChat);
            menuToggle.addEventListener('click', toggleSidebar);
            settingsBtn.addEventListener('click', openApiSettings);
            
            // Example prompts
            document.querySelectorAll('.example-prompt').forEach(prompt => {
                prompt.addEventListener('click', function() {
                    const promptText = this.getAttribute('data-prompt');
                    chatInput.value = promptText;
                    chatInput.focus();
                    sendMessage();
                });
            });
            
            // Close modal when clicking outside
            apiSettingsModal.addEventListener('click', function(e) {
                if (e.target === apiSettingsModal) {
                    closeApiSettingsModal();
                }
            });
            
            // Auto-resize textarea
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 150) + 'px';
                sendButton.disabled = !this.value.trim();
            });
            
            // Notification close
            notification.querySelector('.notification-close').addEventListener('click', function() {
                notification.classList.remove('show');
            });
            
            function updateApiStatus() {
                if (apiKey) {
                    statusBadge.className = 'status-badge status-connected';
                    statusBadge.innerHTML = '<span class="status-dot"></span><span>Connected</span>';
                    
                    apiStatus.className = 'api-status connected';
                    apiStatus.innerHTML = '<span class="status-dot"></span><span>Connected to OpenAI API</span>';
                    
                    disconnectApiBtn.style.display = 'block';
                } else {
                    statusBadge.className = 'status-badge status-demo';
                    statusBadge.innerHTML = '<span class="status-dot"></span><span>Demo Mode</span>';
                    
                    apiStatus.className = 'api-status demo';
                    apiStatus.innerHTML = '<span class="status-dot"></span><span>Currently running in demo mode with simulated responses</span>';
                    
                    disconnectApiBtn.style.display = 'none';
                }
            }
            
            function loadChatSessions() {
                chatHistory.innerHTML = '';
                
                if (chatSessions.length === 0) {
                    return;
                }
                
                chatSessions.forEach(session => {
                    const sessionItem = document.createElement('div');
                    sessionItem.className = 'chat-history-item';
                    if (session.id === currentSessionId) {
                        sessionItem.classList.add('active');
                    }
                    
                    sessionItem.innerHTML = `
                        <i class="bi bi-chat-dots chat-history-icon"></i>
                        <div class="chat-history-title">${session.title}</div>
                    `;
                    
                    sessionItem.addEventListener('click', function() {
                        loadChatSession(session.id);
                    });
                    
                    chatHistory.appendChild(sessionItem);
                });
            }
            
            function loadChatSession(sessionId) {
                const session = chatSessions.find(s => s.id === sessionId);
                if (!session) return;
                
                currentSessionId = sessionId;
                conversationHistory = [...session.messages];
                
                // Update UI
                chatTitle.textContent = session.title;
                welcomeScreen.style.display = 'none';
                
                // Clear existing messages
                const messages = messagesContainer.querySelectorAll('.message');
                messages.forEach(message => message.remove());
                
                // Load messages
                session.messages.forEach(message => {
                    addMessageToUI(message.role, message.content);
                });
                
                // Update active state in sidebar
                document.querySelectorAll('.chat-history-item').forEach((item, index) => {
                    if (chatSessions[index].id === sessionId) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                // Close sidebar on mobile
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('open');
                }
            }
            
            function startNewChat() {
                currentSessionId = Date.now().toString();
                conversationHistory = [];
                
                // Clear messages
                const messages = messagesContainer.querySelectorAll('.message');
                messages.forEach(message => message.remove());
                
                // Show welcome screen
                welcomeScreen.style.display = 'flex';
                chatTitle.textContent = 'New Conversation';
                
                // Update active state in sidebar
                document.querySelectorAll('.chat-history-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Close sidebar on mobile
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('open');
                }
            }
            
            function clearCurrentChat() {
                if (conversationHistory.length === 0) return;
                
                if (confirm('Are you sure you want to clear the current conversation?')) {
                    // If this is a saved session, remove it
                    if (currentSessionId) {
                        chatSessions = chatSessions.filter(s => s.id !== currentSessionId);
                        localStorage.setItem('chat_sessions', JSON.stringify(chatSessions));
                        loadChatSessions();
                    }
                    
                    startNewChat();
                }
            }
            
            function toggleSidebar() {
                sidebar.classList.toggle('open');
            }
            
            function handleKeyDown(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            }
            
            function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;
                
                // Hide welcome screen if visible
                if (welcomeScreen.style.display !== 'none') {
                    welcomeScreen.style.display = 'none';
                }
                
                // Add user message to UI
                addMessageToUI('user', message);
                
                // Add to conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });
                
                // Clear input
                chatInput.value = '';
                chatInput.style.height = 'auto';
                sendButton.disabled = true;
                
                // Show typing indicator
                typingIndicator.style.display = 'block';
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Get response
                if (apiKey) {
                    callOpenAIAPI();
                } else {
                    // Use demo response
                    setTimeout(() => {
                        const randomResponse = demoResponses[Math.floor(Math.random() * demoResponses.length)];
                        addMessageToUI('assistant', randomResponse);
                        
                        // Add to conversation history
                        conversationHistory.push({
                            role: 'assistant',
                            content: randomResponse
                        });
                        
                        // Hide typing indicator
                        typingIndicator.style.display = 'none';
                    }, 1000);
                }
            }
            
            function addMessageToUI(role, content) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${role}`;
                
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'message-avatar';
                avatarDiv.innerHTML = role === 'user' ? '<i class="bi bi-person-fill"></i>' : '<i class="bi bi-robot"></i>';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.textContent = content;
                
                messageDiv.appendChild(avatarDiv);
                messageDiv.appendChild(contentDiv);
                
                // Insert before typing indicator
                messagesContainer.insertBefore(messageDiv, typingIndicator);
                
                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
            
            async function callOpenAIAPI() {
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: model,
                            messages: [
                                {
                                    role: 'system',
                                    content: systemPromptText
                                },
                                ...conversationHistory
                            ],
                            temperature: 0.7,
                            max_tokens: 1000
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'API request failed');
                    }
                    
                    const data = await response.json();
                    const assistantMessage = data.choices[0].message.content;
                    
                    // Add assistant message to conversation history
                    conversationHistory.push({
                        role: 'assistant',
                        content: assistantMessage
                    });
                    
                    // Hide typing indicator
                    typingIndicator.style.display = 'none';
                    
                    // Add assistant message to UI
                    addMessageToUI('assistant', assistantMessage);
                    
                } catch (error) {
                    console.error('Error calling OpenAI API:', error);
                    
                    // Hide typing indicator
                    typingIndicator.style.display = 'none';
                    
                    // Show error message
                    showNotification('error', 'API Error', error.message);
                }
            }
            
            function openApiSettings() {
                apiKeyInput.value = apiKey;
                modelSelect.value = model;
                systemPrompt.value = systemPromptText;
                apiSettingsModal.style.display = 'flex';
            }
            
            function closeApiSettingsModal() {
                apiSettingsModal.style.display = 'none';
            }
            
            function saveApiSettings() {
                const newApiKey = apiKeyInput.value.trim();
                const newModel = modelSelect.value;
                const newSystemPrompt = systemPrompt.value.trim();
                
                if (newApiKey) {
                    apiKey = newApiKey;
                    localStorage.setItem('openai_api_key', apiKey);
                }
                
                model = newModel;
                localStorage.setItem('openai_model', model);
                
                systemPromptText = newSystemPrompt || 'You are a helpful assistant. Be concise and helpful in your responses.';
                localStorage.setItem('system_prompt', systemPromptText);
                
                updateApiStatus();
                closeApiSettingsModal();
                
                showNotification('success', 'Settings Saved', 'Your API settings have been saved successfully.');
            }
            
            function disconnectApi() {
                if (confirm('Are you sure you want to disconnect from the API? The app will return to demo mode.')) {
                    apiKey = '';
                    localStorage.removeItem('openai_api_key');
                    updateApiStatus();
                    closeApiSettingsModal();
                    
                    showNotification('info', 'API Disconnected', 'You are now using the app in demo mode.');
                }
            }
            
            function showNotification(type, title, message) {
                const notificationEl = document.getElementById('notification');
                const icon = notificationEl.querySelector('.notification-icon i');
                const titleEl = notificationEl.querySelector('.notification-title');
                const messageEl = notificationEl.querySelector('.notification-message');
                
                // Set notification type
                notificationEl.className = `notification ${type}`;
                
                // Set icon based on type
                if (type === 'success') {
                    icon.className = 'bi bi-check';
                } else if (type === 'error') {
                    icon.className = 'bi bi-exclamation-triangle';
                } else if (type === 'info') {
                    icon.className = 'bi bi-info';
                }
                
                // Set content
                titleEl.textContent = title;
                messageEl.textContent = message;
                
                // Show notification
                notificationEl.classList.add('show');
                
                // Auto hide after 5 seconds
                setTimeout(() => {
                    notificationEl.classList.remove('show');
                }, 5000);
            }
            
            // Save chat session when user leaves the page
            window.addEventListener('beforeunload', function() {
                if (conversationHistory.length > 0) {
                    // Create a title from the first user message
                    const firstUserMessage = conversationHistory.find(m => m.role === 'user');
                    const title = firstUserMessage 
                        ? (firstUserMessage.content.length > 30 
                            ? firstUserMessage.content.substring(0, 30) + '...' 
                            : firstUserMessage.content)
                        : 'New Conversation';
                    
                    // Update or create session
                    if (currentSessionId) {
                        const sessionIndex = chatSessions.findIndex(s => s.id === currentSessionId);
                        if (sessionIndex !== -1) {
                            chatSessions[sessionIndex] = {
                                id: currentSessionId,
                                title: title,
                                messages: conversationHistory,
                                timestamp: new Date().toISOString()
                            };
                        } else {
                            chatSessions.push({
                                id: currentSessionId,
                                title: title,
                                messages: conversationHistory,
                                timestamp: new Date().toISOString()
                            });
                        }
                    } else {
                        currentSessionId = Date.now().toString();
                        chatSessions.push({
                            id: currentSessionId,
                            title: title,
                            messages: conversationHistory,
                            timestamp: new Date().toISOString()
                        });
                    }
                    
                    // Keep only the 20 most recent sessions
                    if (chatSessions.length > 20) {
                        chatSessions = chatSessions.slice(-20);
                    }
                    
                    localStorage.setItem('chat_sessions', JSON.stringify(chatSessions));
                }
            });
        });
    </script>
</body>
</html>
